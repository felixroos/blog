---
title: Harmonic Spirals
date: 2020-05-05
---

import Spiral from '../components/common/Spiral.tsx';
import HarmonicSpiral from '../components/tuning/HarmonicSpiral.tsx';
import SpiralSettings from '../components/common/SpiralSettings.tsx';
import { State } from 'react-powerplug';
import Slider from '@material-ui/core/Slider';
import Grid from '@material-ui/core/Grid';
import AnimationFrame from '../components/common/AnimationFrame.tsx';
import {
  angle,
  frequencyColor,
  equivalence,
  clamp
} from '../components/tuning/tuning.ts';
import SimplePopover from '../components/common/Popover';
import * as Tone from 'tone';
import canUseDOM from '../components/canUseDOM.ts';
const { PolySynth, Synth } = Tone;
const harp =
  canUseDOM() &&
  new PolySynth(6, Synth, {
    volume: -16,
    envelope: { attack: 0.01, decay: 2, sustain: 0, release: 0.1 },
    oscillator: { type: 'fmtriangle' }
  }).toMaster();

Let's play [Erv Wilson](http://www.anaphoria.com/harm-subharm.pdf) and create some harmonic spirals.

## Harmonic Spiral

<State
  initial={{
    zoom: 0.11,
    spin: 0,
    precision: 4,
    min: 0,
    max: 6,
    strokeWidth: 3,
    base: 55,
    fontSize: 10,
    logarithmic: false,
    hideLabels: false,
    hideLines: false
  }}
>
  {({ state, setState }) => (
    <>
      <div
        style={{
          overflow: 'auto',
          maxWidth: 900,
          maxHeight: 700,
          position: 'relative'
        }}
      >
        <HarmonicSpiral
          width={600}
          height={600}
          stroke="gray"
          {...state}
          getRadius={(angle, maxRadius, zoom) => {
            if (state.logarithmic) {
              const compensation = 41;
              return (
                Math.pow(2, Math.abs(angle)) *
                Math.abs(state.zoom * compensation)
              );
            }
            return angle * maxRadius * zoom;
          }}
          onTrigger={(partial) => harp.triggerAttackRelease(partial * state.base, 1)}
        />
        <div style={{ position: 'absolute', left: 10, bottom: 30 }}>
          <SimplePopover placement="left-start">
            <div style={{ width: 300 }}>
              <SpiralSettings state={state} setState={setState} />
              <br />
              <label>
                <input
                  type="checkbox"
                  checked={state.logarithmic}
                  onChange={(e) => setState({ logarithmic: e.target.checked })}
                />
                Logarithmic
              </label>
              <br />
              <label>
                <input
                  type="checkbox"
                  checked={!state.hideLabels}
                  onChange={(e) => setState({ hideLabels: !e.target.checked })}
                />
                Labels
              </label>
              <br />
              <label>
                <input
                  type="checkbox"
                  checked={!state.hideLines}
                  onChange={(e) => setState({ hideLines: !e.target.checked })}
                />
                Lines
              </label>
            </div>
          </SimplePopover>
        </div>
      </div>
    </>
  )}
</State>

- you can think of this as a number line with a twist
- starting at 1 (root pitch) in the center, we map one full rotation (=360 degrees) to the multiplication of 2 (octaves)
- each line starts at an odd number representing the beginning of a new pitch color
- the line extends to infinity, crossing the spiral at octaves of the color
- all natural numbers will be part of a line
- the whole image is a dense visualization of the harmonic series from the perspective of octaves
- it gets even more accurate (but not as compact) if we use a logarithmic spiral
  - its radius gets two times bigger on every rotation.
  - its growth represents the behaviour of frequencies, as we go up the harmonic series.

## Scale Spiral

stacked fourths vs 12EDO

<State
  initial={{
    zoom: 0.8,
    spin: 0,
    precision: 1,
    min: 1,
    max: 6,
    strokeWidth: 2,
    base: 55,
    fontSize: 12
  }}
>
  {({ state, setState }) => {
    const generator = 4 / 3;
    const notes = 54;
    const octaveRadius = 60;
    let ratios = Array.from({ length: notes }, (_, i) =>
      Math.pow(generator, i)
    );
    const show12EDO = true;
    const temper = false;
    const reduce = true;
    const eq = temper ? 2 : equivalence(Math.pow(generator, 12), 2);
    const comma = 1 - equivalence(Math.pow(generator, 12), 2) / 2;
    // const comma = 1 - equivalence(Math.pow(generator, 12), 2);
    if (temper) {
      ratios = ratios.map((ratio, i) => ratio * (1 + (comma * i) / 12));
    }
    if (reduce) {
      ratios = ratios.map((ratio, i) => {
        return clamp(ratio, Math.pow(eq, Math.floor((i - 1) / 12))); // ;
        //return equivalence(ratio, Math.pow(eq, Math.floor((i - 1) / 12)));
        //return equivalence(ratio, 2) * Math.pow(2, Math.floor(i / 12));
      });
    }
    return (
      <>
        <div
          style={{
            overflow: 'auto',
            maxWidth: 900,
            maxHeight: 700,
            position: 'relative'
          }}
        >
          <Spiral
            width={600}
            height={600}
            stroke="gray"
            {...state}
            getRadius={(angle, maxRadius, zoom) => zoom * angle * octaveRadius}
            lines={[]
              .concat(
                show12EDO
                  ? Array.from({ length: 12 }, (_, i) => [
                      0,
                      angle(Math.pow(2, i / 12) * Math.pow(2, state.max)),
                      'gray'
                    ])
                  : []
              )
              .concat(
                ratios.map((ratio, i) => [
                  angle(ratio * 2),
                  angle(ratio * Math.pow(2, state.max)),
                  frequencyColor(ratio * state.base)
                ])
              )}
            labels={ratios.map((ratio, i) => ({
              label: i + '',
              angle: angle(ratio * 2),
              fill: frequencyColor(ratio * 440),
              color: 'black'
            }))}
            onTrigger={(i) =>
              harp.triggerAttackRelease(ratios[i] * state.base, 1)
            }
          />
          <div style={{ position: 'absolute', left: 10, bottom: 30 }}>
            <SimplePopover placement="left-start">
              <div style={{ width: 300 }}>
                <SpiralSettings state={state} setState={setState} />
              </div>
            </SimplePopover>
          </div>
        </div>
      </>
    );
  }}
</State>

## Tempered Pythagorean Tuning

stacked fifths vs 12edo

<State
  initial={{
    zoom: 0.4,
    spin: 0,
    precision: 1,
    min: 0,
    max: 2,
    strokeWidth: 2,
    base: 55,
    fontSize: 14
  }}
>
  {({ state, setState }) => {
    const generator = 3 / 2;
    const notes = 25;
    const comma = equivalence(Math.pow(generator, 12), 2) - 1;
    const temper = true;
    const tempered = (i) => (temper ? 1 / (1 + (comma * i) / 12) : 1);
    const ratios = Array.from(
      { length: notes },
      (_, i) =>
        equivalence(Math.pow(generator, i), 2) *
        tempered(i) *
        Math.pow(2, Math.floor(i / 12))
    );
    const angles = ratios.map((ratio) => angle(ratio)).sort();
    return (
      <>
        <div
          style={{
            overflow: 'auto',
            maxWidth: 900,
            maxHeight: 700,
            position: 'relative'
          }}
        >
          <Spiral
            width={600}
            height={600}
            stroke="gray"
            {...state}
            max={angles[angles.length - 1] + 1}
            getRadius={(angle, maxRadius, zoom) => 100 + angle * 100 * zoom}
            lines={[]
              .concat(
                Array.from({ length: 12 }, (_, i) => [
                  angle(Math.pow(2, i / 12)),
                  angle(Math.pow(2, i / 12) * Math.pow(2, state.max)),
                  'gray'
                ])
              )
              .concat(
                ratios.map((ratio) => [
                  angle(ratio),
                  angle(ratio * Math.pow(2, 1)),
                  frequencyColor(ratio * 440)
                ])
              )
              .concat(
                angles.map((angle, i) => {
                  const next = i + 5;
                  return [
                    angle,
                    angles[next % angles.length] +
                      Math.floor(next / angles.length),
                    'transparent'
                  ];
                })
              )}
            onTrigger={(i) =>
              harp.triggerAttackRelease((i + 1) * state.base, 1)
            }
          />
          <div style={{ position: 'absolute', left: 10, bottom: 30 }}>
            <SimplePopover placement="left-start">
              <div style={{ width: 300 }}>
                <SpiralSettings state={state} setState={setState} />
              </div>
            </SimplePopover>
          </div>
        </div>
      </>
    );
  }}
</State>

- Tempered Pythagorean Tuning equals 12edo!!
